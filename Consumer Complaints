-- DELETE COMPLAINTS WHERE CONSUMER_COMPLAINT IS NULL
DELETE FROM COMPLAINTS
WHERE CONSUMER_COMPLAINT IS NULL;

-- NUMBER OF COMPLAINTS SENT AND RECEIVED ON THE SAME DAY
SELECT COUNT(CONSUMER_COMPLAINT) AS TOTAL_COMPLAINTS
FROM COMPLAINTS
WHERE DATE_RECEIVED = DATE_SENT
GROUP BY CONSUMER_COMPLAINT;

-- EXTRACT THE COMPLAINTS RECEIVED IN THE STATES OF NEW YORK
SELECT COUNT(CONSUMER_COMPLAINT), COMPLAINT_ID, STATE
FROM COMPLAINTS
WHERE STATE IN ('NY', 'NJ', 'CT')
GROUP BY CONSUMER_COMPLAINT, COMPLAINT_ID, STATE;

-- ROWS WITH THE WORD CREDIT IN PRODUCT FIELD
SELECT *
FROM COMPLAINTS
WHERE PRODUCT_NAME LIKE '%CREDIT%' AND CONSUMER_COMPLAINT IS NOT NULL;

-- STATE WITH HIGHEST NUMBER OF COMPLAINTS
SELECT STATE, COUNT(CONSUMER_COMPLAINT) AS TOTAL_COMPLAINTS
FROM COMPLAINTS
GROUP BY STATE, CONSUMER_COMPLAINT
ORDER BY TOTAL_COMPLAINTS DESC
LIMIT 1;

-- TOP 10 MOST COMMON ISSUES REPORTED BY CONSUMERS
SELECT ISSUE, COUNT(ISSUE) AS TOTAL_REPORTED
FROM COMPLAINTS
GROUP BY ISSUE
ORDER BY TOTAL_REPORTED DESC
LIMIT 10;

-- TOP 10 COMPANIES WITH THE HIGHEST POSITIVE RESPONSE RATE
SELECT COMPANY,
       (SUM(CASE WHEN TIMELY_RESPONSE = 'YES' THEN 1 ELSE 0 END) / COUNT(TIMELY_RESPONSE) * 100) AS POSITIVE_RESPONSE
FROM COMPLAINTS
GROUP BY COMPANY
ORDER BY POSITIVE_RESPONSE ASC
LIMIT 10;

-- RANKING OF TOP 10 COMPANIES BY NUMBER OF COMPLAINTS RECEIVED
SELECT COMPANY, COUNT(CONSUMER_COMPLAINT) AS COMPLAINTS_RECEIVED
FROM COMPLAINTS
GROUP BY COMPANY, CONSUMER_COMPLAINT
ORDER BY COMPLAINTS_RECEIVED DESC
LIMIT 10;
